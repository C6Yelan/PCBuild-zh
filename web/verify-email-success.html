<!doctype html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <title>驗證成功 · PCBuild-zh</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light dark;
      }
      :root {
        --surface: Canvas;
        --text: CanvasText;
        --border: color-mix(in srgb, CanvasText 12%, Canvas);
        --muted: color-mix(in srgb, CanvasText 50%, Canvas);
        --danger: #22c55e; /* 保留同一套 CSS 結構，僅把標題色改為成功色 */
        --btn-bg: color-mix(in srgb, CanvasText 5%, Canvas);
        --btn-bg-hover: color-mix(in srgb, CanvasText 10%, Canvas);
      }
      body {
        margin: 0;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          "Noto Sans TC", "PingFang TC", "Microsoft JhengHei";
        background: radial-gradient(
          circle at top,
          color-mix(in srgb, CanvasText 5%, Canvas),
          Canvas
        );
        color: var(--text);
      }
      .container {
        width: 100%;
        max-width: 420px;
        padding: 16px;
      }
      .card {
        border-radius: 16px;
        border: 1px solid var(--border);
        background: var(--surface);
        padding: 24px 20px 20px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.12);
      }
      .logo {
        font-weight: 700;
        font-size: 22px;
        margin-bottom: 4px;
        text-align: center;
      }
      .title {
        text-align: center;
        font-size: 18px;
        margin: 8px 0 12px;
      }
      .title span {
        color: var(--danger);
        font-weight: 700;
      }
      .content {
        font-size: 14px;
        line-height: 1.6;
        margin-bottom: 16px;
      }
      .hint {
        font-size: 13px;
        color: var(--muted);
        margin: 0 0 20px;
      }
      .actions {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
      .btn {
        font-family: inherit;
        cursor: pointer;
        padding: 9px 18px;
        border-radius: 999px;
        font-size: 14px;
        border: 1px solid var(--border);
        background: var(--btn-bg);
        color: var(--text);
        text-decoration: none;
        text-align: center;
        min-width: 160px;
      }
      .btn:hover {
        background: var(--btn-bg-hover);
      }
      .link {
        font-size: 13px;
        color: inherit;
        text-decoration: underline;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <div class="logo">PCBuild-zh</div>
        <div class="title">
          <span>Email 驗證成功</span>
        </div>

        <div class="content" id="success-content" style="white-space: pre-line;">
          您的信箱已完成驗證，帳號已啟用。<br />
          若您目前已登入，請回到首頁繼續使用；若尚未登入，請前往登入頁面。
        </div>

        <div class="hint" id="success-hint" style="white-space: pre-line;">
          若您在驗證前已開啟 PCBuild，回到首頁後可重新整理頁面以更新狀態。
        </div>

        <div class="actions">
          <a id="primary-action" href="/" class="btn">回到首頁</a>
          <a id="secondary-action" href="/login.html" class="link">前往登入</a>
        </div>
      </div>
    </div>
    <script>
      (async () => {
        const contentEl = document.getElementById("success-content");
        const hintEl = document.getElementById("success-hint");
        const primary = document.getElementById("primary-action");
        const secondary = document.getElementById("secondary-action");

        // 與你其他頁面一致的 flow key（若沒用到也不影響）
        const FLOW_KEY = "pcbuild_verify_flow"; // "signup" | "home"

        function apply(mode) {
          if (mode === "home") {
            contentEl.textContent =
              "Email 驗證成功。您目前已登入（同帳號）可直接回到首頁繼續使用。";
            hintEl.textContent =
              "若首頁仍顯示「尚未驗證」，請回到首頁後重新整理一次。";

            primary.textContent = "回到首頁";
            primary.href = "/";

            // 次要動作保留（不影響主要按鈕需求）
            secondary.textContent = "前往登入";
            secondary.href = "/login.html";
            secondary.style.display = "";
            return;
          }

          // mode === "login"
          contentEl.textContent =
            "Email 驗證成功。為了更新帳號狀態，請前往登入頁重新登入。";
          hintEl.textContent =
            "若您是從註冊流程完成驗證，重新登入後即可開始使用。";

          primary.textContent = "前往登入";
          primary.href = "/login.html";

          secondary.textContent = "回到首頁";
          secondary.href = "/";
          secondary.style.display = "";
        }

        function normalizeMode(v) {
          const m = String(v || "").toLowerCase();
          return m === "home" || m === "login" ? m : "";
        }

        // 1) 後端若有帶 mode=home/login，優先採用
        const params = new URLSearchParams(window.location.search);
        let mode = normalizeMode(params.get("mode"));

        // 2) 若未帶 mode，嘗試用 sessionStorage flow 判斷（可選）
        if (!mode) {
          const flow = String(sessionStorage.getItem(FLOW_KEY) || "").toLowerCase();
          if (flow === "home") mode = "home";
          else if (flow === "signup") mode = "login";
        }

        // 3) 最後用 /api/auth/me 推斷：有登入且已 active -> home，否則 login
        if (!mode) {
          try {
            const resp = await fetch("/api/auth/me", {
              method: "GET",
              credentials: "same-origin",
            });

            if (resp.ok) {
              const data = await resp.json().catch(() => null);

              // 你目前檔案原先就是用 is_active 推斷 :contentReference[oaicite:1]{index=1}
              // 這裡維持相同假設：登入且 active => 視為「同帳號驗證完成」情境
              if (data && data.is_active === true) mode = "home";
            }
          } catch (e) {
            // ignore
          }
          if (!mode) mode = "login";
        }

        apply(mode);
      })();
    </script>
  </body>
</html>
